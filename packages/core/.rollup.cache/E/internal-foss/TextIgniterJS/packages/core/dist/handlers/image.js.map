{"version":3,"file":"image.js","sourceRoot":"","sources":["../../src/handlers/image.ts"],"names":[],"mappings":"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","sourcesContent":["import { getSelectionRange } from \"../utils/selectionManager\";\r\nimport EditorView from \"../view/editorView\";\r\nimport TextDocument from \"../textDocument\";\r\nimport Piece from \"../piece\";\r\nimport {\r\n  extractTextFromDataId,\r\n  addBlockAfter,\r\n} from \"../utils/selectionManager\";\r\nimport { strings } from \"../constants/strings\";\r\n\r\nexport class ImageHandler {\r\n  private editor: HTMLElement;\r\n  private editorView!: EditorView;\r\n  private document: TextDocument;\r\n  public isImageHighlighted: boolean;\r\n  public highLightedImageDataId: string;\r\n  public currentCursorLocation: number;\r\n  public isCrossIconVisible: boolean;\r\n\r\n  constructor(editor: HTMLElement, document: TextDocument) {\r\n    this.editor = editor;\r\n    this.document = document;\r\n    this.isImageHighlighted = false;\r\n    this.highLightedImageDataId = \"\";\r\n    this.currentCursorLocation = 0;\r\n    this.isCrossIconVisible = false;\r\n  }\r\n\r\n  setEditorView(editorView: EditorView) {\r\n    this.editorView = editorView;\r\n  }\r\n\r\n  public insertImage(): void {\r\n    const fileInput = document.createElement(\"input\");\r\n    fileInput.type = \"file\";\r\n    fileInput.accept = \"image/*\";\r\n    fileInput.click();\r\n    fileInput.onchange = () => {\r\n      const file = fileInput.files ? fileInput.files[0] : null;\r\n      if (file) {\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => {\r\n          const dataUrl = e.target?.result as string;\r\n          this.insertImageAtCursor(dataUrl);\r\n        };\r\n        reader.readAsDataURL(file);\r\n      }\r\n    };\r\n  }\r\n\r\n  public insertImageAtCursor(dataUrl: string): void {\r\n    const [start, end] = getSelectionRange(this.editorView);\r\n    console.log(start, end, 'vicky insertImage', dataUrl)\r\n    if (end > start) {\r\n      this.document.deleteRange(start, end, this.document.selectedBlockId);\r\n    }\r\n    this.insertImageAtPosition(dataUrl, start, this.document.selectedBlockId);\r\n  }\r\n\r\n  public setCursorPostion(postion: number, dataId: string): void {\r\n    const div = document.querySelector(`[data-id=\"${dataId}\"]`) as HTMLElement;\r\n    div.focus();\r\n    setTimeout(() => {\r\n      const range = document.createRange();\r\n      const sel = window.getSelection();\r\n      if (div.firstChild) {\r\n        range.setStart(div.firstChild, postion);\r\n      } else {\r\n        const textNode = document.createTextNode(\"\");\r\n        div.appendChild(textNode);\r\n        range.setStart(textNode, 0);\r\n      }\r\n      range.collapse(true);\r\n      sel?.removeAllRanges();\r\n      sel?.addRange(range);\r\n    }, 0);\r\n  }\r\n\r\n  public insertImageAtPosition(\r\n    dataUrl: string,\r\n    position: number,\r\n    dataId: string | null\r\n  ): void {\r\n    console.log(dataUrl, position, dataId, \"vicky insertImageAtPosition\", this.document.blocks)\r\n    const uniqueId1 = `data-id-${Date.now()}-${Math.random() * 1000}`;\r\n    const uniqueId2 = `data-id-${Date.now()}-${Math.random() * 1000}`;\r\n    const uniqueId3 = `data-id-${Date.now()}-${Math.random() * 1000}`;\r\n    const newImageBlock = {\r\n      dataId: uniqueId1,\r\n      class: strings.PARAGRAPH_BLOCK_CLASS,\r\n      pieces: [new Piece(\" \")],\r\n      type: \"image\",\r\n      image: dataUrl,\r\n    };\r\n    const newTextBlock = {\r\n      dataId: uniqueId2,\r\n      class: strings.PARAGRAPH_BLOCK_CLASS,\r\n      pieces: [new Piece(\" \")],\r\n      type: \"text\",\r\n    };\r\n\r\n    let selectedBlockId = this.document.selectedBlockId;\r\n    const indexOfCurrentBlock = this.document.blocks.findIndex(\r\n      (block: any) => block.dataId === this.document.selectedBlockId\r\n    );\r\n    let newBlocks: any[] = [];\r\n\r\n    const { remainingText, piece } = extractTextFromDataId(\r\n      selectedBlockId || \"\",\r\n      this.document\r\n    );\r\n    console.log(selectedBlockId || \"\",\r\n      this.document, \"extractTextFromDataId-vicky\", remainingText, piece)\r\n    const extractedContent = \" \" + remainingText;\r\n    let updatedBlock = this.document.blocks;\r\n\r\n    if (extractedContent.length > 0) {\r\n      const _extractedContent = remainingText.split(\" \");\r\n      let _pieces = [];\r\n      if (_extractedContent[0] !== \"\" || _extractedContent[1] !== undefined) {\r\n        if (piece.length === 1) {\r\n          _pieces = [new Piece(extractedContent, piece[0].attributes)];\r\n        } else {\r\n          _pieces.push(\r\n            new Piece(\" \" + _extractedContent[0] + \" \", piece[0].attributes)\r\n          );\r\n          if (piece.length >= 2) {\r\n            piece.forEach((obj: any, i: number) => {\r\n              if (i !== 0) {\r\n                _pieces.push(obj);\r\n              }\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        _pieces = [new Piece(\" \")];\r\n      }\r\n      console.log(this.document.selectedBlockId, 'uniqueId3 extractTextFromDataId-vicky', uniqueId3)\r\n      updatedBlock = addBlockAfter(\r\n        this.document.blocks,\r\n        this.document.selectedBlockId || \"\",\r\n        {\r\n          dataId: uniqueId3,\r\n          class: strings.PARAGRAPH_BLOCK_CLASS,\r\n          pieces: _pieces,\r\n          type: \"text\",\r\n        }\r\n      );\r\n    }\r\n    this.document.blocks = updatedBlock;\r\n\r\n    this.document.deleteRange(\r\n      this.currentCursorLocation,\r\n      this.currentCursorLocation + remainingText.length,\r\n      this.document.selectedBlockId,\r\n      this.document.currentOffset\r\n    );\r\n\r\n    if (this.document.blocks.length > indexOfCurrentBlock + 1) {\r\n      this.document.blocks.forEach((block: any, idx: number) => {\r\n        newBlocks.push(block);\r\n        if (idx === indexOfCurrentBlock) newBlocks.push(newImageBlock);\r\n        else if (selectedBlockId === this.document.selectedBlockId)\r\n          selectedBlockId = block.dataId;\r\n      });\r\n    } else {\r\n      newBlocks = [...this.document.blocks, newImageBlock, newTextBlock];\r\n      selectedBlockId = newTextBlock.dataId;\r\n    }\r\n\r\n    this.document.blocks = newBlocks;\r\n    this.editorView.render();\r\n    this.document.selectedBlockId = selectedBlockId;\r\n\r\n    const div = document.querySelector(\r\n      `[data-id=\"${selectedBlockId}\"]`\r\n    ) as HTMLElement;\r\n    div.focus();\r\n\r\n    setTimeout(() => {\r\n      const range = document.createRange();\r\n      const sel = window.getSelection();\r\n      if (div.firstChild) {\r\n        range.setStart(div.firstChild, 1);\r\n      } else {\r\n        const textNode = document.createTextNode(\"\");\r\n        div.appendChild(textNode);\r\n        range.setStart(textNode, 0);\r\n      }\r\n      range.collapse(true);\r\n      sel?.removeAllRanges();\r\n      sel?.addRange(range);\r\n    }, 0);\r\n  }\r\n\r\n  public createImageFragment(imageUrl: string, dataId: string) {\r\n    const fragment = document.createDocumentFragment();\r\n    const img = document.createElement(\"img\");\r\n    img.src = imageUrl;\r\n    img.style.maxWidth = \"30%\";\r\n    img.setAttribute(\"contenteditable\", \"false\");\r\n    fragment.appendChild(img);\r\n\r\n    const span = document.createElement(\"span\");\r\n    span.setAttribute(\"contenteditable\", \"false\");\r\n    span.appendChild(fragment);\r\n    img.addEventListener(\"click\", () => this.addStyleToImage(dataId));\r\n    return span;\r\n  }\r\n\r\n  public addStyleToImage(dataId: string) {\r\n    if (!this.isCrossIconVisible) {\r\n      const div = document.querySelector(`[data-id=\"${dataId}\"]`) as HTMLElement;\r\n      const span = div?.querySelector(\"span\");\r\n      if (span) span.style.position = \"relative\";\r\n      const img = div?.querySelector(\"img\");\r\n      if (img) {\r\n        img.style.border = \"2px solid blue\";\r\n      }\r\n      const cross = document.createElement(\"div\");\r\n      cross.className = strings.IMAGE_CROSS_CLASS;\r\n      cross.innerHTML = \"x\";\r\n      Object.assign(cross.style, {\r\n        position: \"absolute\",\r\n        top: \"0\",\r\n        left: \"50%\",\r\n        transform: \"translate(-50%, 0)\",\r\n        background: \"#fff\",\r\n        borderRadius: \"50%\",\r\n        width: \"30px\",\r\n        height: \"30px\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        cursor: \"pointer\",\r\n        border: \"3px solid blue\",\r\n        zIndex: \"999\",\r\n      });\r\n      cross.addEventListener(\r\n        \"mouseover\",\r\n        () => (cross.style.border = \"3px solid black\")\r\n      );\r\n      cross.addEventListener(\r\n        \"mouseout\",\r\n        () => (cross.style.border = \"3px solid blue\")\r\n      );\r\n      cross.addEventListener(\"click\", (e) => {\r\n        e.stopPropagation();\r\n        this.deleteImage();\r\n      });\r\n      span?.appendChild(cross);\r\n      this.isImageHighlighted = true;\r\n      this.highLightedImageDataId = dataId;\r\n      this.isCrossIconVisible = true;\r\n    }\r\n  }\r\n\r\n  public clearImageStyling() {\r\n    const div = document.querySelector(\r\n      `[data-id=\"${this.highLightedImageDataId}\"]`\r\n    ) as HTMLElement;\r\n    if (div) {\r\n      const span = div.querySelector(\"span\");\r\n      span?.removeAttribute(\"style\");\r\n      const img = span?.querySelector(\"img\");\r\n      if (img) {\r\n        img.removeAttribute(\"style\");\r\n      }\r\n      const cross = span?.querySelector(`.${strings.IMAGE_CROSS_CLASS}`);\r\n      cross?.remove();\r\n      this.highLightedImageDataId = \"\";\r\n    }\r\n    this.isCrossIconVisible = false;\r\n  }\r\n\r\n  public deleteImage() {\r\n    this.document.blocks = this.document.blocks.filter(\r\n      (block: any) => block.dataId !== this.highLightedImageDataId\r\n    );\r\n    this.highLightedImageDataId = \"\";\r\n    this.isImageHighlighted = false;\r\n    this.clearImageStyling();\r\n    this.document.emit(\"documentChanged\", this);\r\n  }\r\n}\r\n"]}